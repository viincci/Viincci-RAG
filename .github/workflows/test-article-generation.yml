- name: Generate Article
      run: |
        python -c "
        import json
        import os
        from datetime import datetime
        from V4.ConfigManager import ConfigManager
        from V4.UniversalArticleGenerator import UniversalArticleGenerator
        from V4.RagSys import RAGSystem
        
        print('\n' + '='*70)
        print('üìù Generating Article')
        print('='*70 + '\n')
        
        domain = '${{ github.event.inputs.domain }}'
        query = '${{ github.event.inputs.query }}'
        use_rag = '${{ github.event.inputs.use_rag }}' == 'true'
        fetch_images = '${{ github.event.inputs.fetch_images }}' == 'true'
        
        print(f'Domain: {domain}')
        print(f'Query: {query}')
        print(f'Use RAG: {use_rag}')
        print(f'Fetch Images: {fetch_images}\n')
        
        # Load research data
        with open('research_output/research_data.json', 'r', encoding='utf-8') as f:
            research_data = json.load(f)
        
        sources = research_data['sources']
        print(f'Loaded {len(sources)} sources\n')
        
        # Initialize config
        config = ConfigManager(domain=domain, verbose=True)
        
        # Initialize RAG system if requested
        rag_system = None
        if use_rag and os.path.exists('research_output/rag_index.faiss'):
            print('Loading RAG system...')
            try:
                rag_system = RAGSystem(config)
                
                with open('research_output/rag_texts.json', 'r') as f:
                    rag_data = json.load(f)
                
                rag_system.load_index(
                    'research_output/rag_index.faiss',
                    rag_data['texts'],
                    rag_data['metadata']
                )
                
                # CRITICAL: Load the LLM generator
                print('Loading LLM model for RAG generation...')
                rag_system.load_llm()
                print('‚úÖ RAG system fully loaded with LLM\n')
            except Exception as e:
                print(f'‚ö†Ô∏è  Failed to load RAG: {e}')
                print('Continuing without RAG...\n')
                rag_system = None
